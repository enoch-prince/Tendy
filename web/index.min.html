<!DOCTYPE html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Testing a Joystick Library"><meta name=author content="Enoch Prince"><title>My Joystick Controls</title><link rel=stylesheet href=style.css><style>body,html{height:100%}body{margin:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}div{display:grid}input{text-align:center}.flex-container{height:100%;padding:0;margin:0;display:flex;align-items:center;justify-content:center}.row{width:auto}.flex-item{padding:5px;margin:5px;align-items:center}.title{text-align:center}.joystick-info{text-align:center}#myjoystick{width:200px;height:200px;margin:50px}</style><script>let StickStatus = { xPosition: 0, yPosition: 0, x: 0, y: 0, cardinalDirection: "C" }; var JoyStick = function (t, e, i) { var o = void 0 === (e = e || {}).title ? "joystick" : e.title, n = void 0 === e.width ? 0 : e.width, a = void 0 === e.height ? 0 : e.height, r = void 0 === e.internalFillColor ? "#00AA00" : e.internalFillColor, c = void 0 === e.internalLineWidth ? 2 : e.internalLineWidth, s = void 0 === e.internalStrokeColor ? "#003300" : e.internalStrokeColor, d = void 0 === e.externalLineWidth ? 2 : e.externalLineWidth, u = void 0 === e.externalStrokeColor ? "#008000" : e.externalStrokeColor, h = void 0 === e.autoReturnToCenter || e.autoReturnToCenter; i = i || function (t) { }; var S = document.getElementById(t); S.style.touchAction = "none"; var f = document.createElement("canvas"); f.id = o, 0 === n && (n = S.clientWidth), 0 === a && (a = S.clientHeight), f.width = n, f.height = a, S.appendChild(f); var l = f.getContext("2d"), k = 0, g = 2 * Math.PI, x = (f.width - (f.width / 2 + 10)) / 2, v = x + 5, P = x + 30, m = f.width / 2, C = f.height / 2, p = f.width / 10, y = -1 * p, w = f.height / 10, L = -1 * w, F = m, E = C; function W() { l.beginPath(), l.arc(m, C, P, 0, g, !1), l.lineWidth = d, l.strokeStyle = u, l.stroke() } function T() { l.beginPath(), F < x && (F = v), F + x > f.width && (F = f.width - v), E < x && (E = v), E + x > f.height && (E = f.height - v), l.arc(F, E, x, 0, g, !1); var t = l.createRadialGradient(m, C, 5, m, C, 200); t.addColorStop(0, r), t.addColorStop(1, s), l.fillStyle = t, l.fill(), l.lineWidth = c, l.strokeStyle = s, l.stroke() } function D() { let t = "", e = F - m, i = E - C; return i >= L && i <= w && (t = "C"), i < L && (t = "N"), i > w && (t = "S"), e < y && ("C" === t ? t = "W" : t += "W"), e > p && ("C" === t ? t = "E" : t += "E"), t } "ontouchstart" in document.documentElement ? (f.addEventListener("touchstart", function (t) { k = 1 }, !1), document.addEventListener("touchmove", function (t) { 1 === k && t.targetTouches[0].target === f && (F = t.targetTouches[0].pageX, E = t.targetTouches[0].pageY, "BODY" === f.offsetParent.tagName.toUpperCase() ? (F -= f.offsetLeft, E -= f.offsetTop) : (F -= f.offsetParent.offsetLeft, E -= f.offsetParent.offsetTop), l.clearRect(0, 0, f.width, f.height), W(), T(), StickStatus.xPosition = F, StickStatus.yPosition = E, StickStatus.x = ((F - m) / v * 100).toFixed(), StickStatus.y = ((E - C) / v * 100 * -1).toFixed(), StickStatus.cardinalDirection = D(), i(StickStatus)) }, !1), document.addEventListener("touchend", function (t) { k = 0, h && (F = m, E = C); l.clearRect(0, 0, f.width, f.height), W(), T(), StickStatus.xPosition = F, StickStatus.yPosition = E, StickStatus.x = ((F - m) / v * 100).toFixed(), StickStatus.y = ((E - C) / v * 100 * -1).toFixed(), StickStatus.cardinalDirection = D(), i(StickStatus) }, !1)) : (f.addEventListener("mousedown", function (t) { k = 1 }, !1), document.addEventListener("mousemove", function (t) { 1 === k && (F = t.pageX, E = t.pageY, "BODY" === f.offsetParent.tagName.toUpperCase() ? (F -= f.offsetLeft, E -= f.offsetTop) : (F -= f.offsetParent.offsetLeft, E -= f.offsetParent.offsetTop), l.clearRect(0, 0, f.width, f.height), W(), T(), StickStatus.xPosition = F, StickStatus.yPosition = E, StickStatus.x = ((F - m) / v * 100).toFixed(), StickStatus.y = ((E - C) / v * 100 * -1).toFixed(), StickStatus.cardinalDirection = D(), i(StickStatus)) }, !1), document.addEventListener("mouseup", function (t) { k = 0, h && (F = m, E = C); l.clearRect(0, 0, f.width, f.height), W(), T(), StickStatus.xPosition = F, StickStatus.yPosition = E, StickStatus.x = ((F - m) / v * 100).toFixed(), StickStatus.y = ((E - C) / v * 100 * -1).toFixed(), StickStatus.cardinalDirection = D(), i(StickStatus) }, !1)), W(), T(), this.GetWidth = function () { return f.width }, this.GetHeight = function () { return f.height }, this.GetPosX = function () { return F }, this.GetPosY = function () { return E }, this.GetX = function () { return ((F - m) / v * 100).toFixed() }, this.GetY = function () { return ((E - C) / v * 100 * -1).toFixed() }, this.GetDir = function () { return D() } };</script></head><body><div class=flex-container><div class=flex-row><div class=flex-item><h4 class=title>Tendy V1.0.1 Control</h4></div><div class=flex-item><div id=myjoystick></div></div><div class=flex-item><div class=joystick-info>Position X: <input type=text id=PositionX><br>Position Y: <input type=text id=PositionY><br>Direction: <input type=text id=Direction><br>X : <input type=text id=X><br>Y : <input type=text id=Y></div></div><div class="flex-item"><div id="stream"></div> </div></div></div><script>const view = document.getElementById('stream'); const WS_URL = `ws://${window.location.host}/ws`; const ws = new WebSocket(WS_URL); if (ws !== undefined) { ws.onmessage = message => { if (message.data instanceof Blob) { var urlObject = URL.createObjectURL(message.data); view.src = urlObject } } } let lastText, lastSend, sendTimeout; function ws_send(txt) {var now = new Date().getTime(); if (lastSend === undefined || now - lastSend >= 30) { try { ws.send(txt); lastSend = new Date().getTime(); return } catch (e) { console.log(e) } } lastText = txt; if (!sendTimeout) {let ms = lastSend !== undefined ? 30 - (now - lastSend) : 30; if (ms < 0) ms = 0; sendTimeout = setTimeout(() => { sendTimeout = null; ws_send(lastText) }, ms)}}</script><script>let joystickInputPosX = document.getElementById("PositionX"); let joystickInputPosY = document.getElementById("PositionY"); let joystickDirection = document.getElementById("Direction"); let joystickX = document.getElementById("X"); let joystickY = document.getElementById("Y"); let CustomJoystick = new JoyStick("myjoystick", {}, function (stickData) { joystickInputPosX.value = stickData.xPosition; joystickInputPosY.value = stickData.yPosition; joystickDirection.value = stickData.cardinalDirection; joystickX.value = stickData.x; joystickY.value = stickData.y }); function getDrivePowerFrom(nJoyX, nJoyY) { const SCALING_VALUE = 100.0; let nMotMixL; let nMotMixR; let fPivYLimit = 32.0; let nMotPremixL; let nMotPremixR; let nPivSpeed; let fPivScale; if (nJoyY >= 0) { nMotPremixL = (nJoyX >= 0 ? SCALING_VALUE : SCALING_VALUE + parseFloat(nJoyX)); nMotPremixR = (nJoyX >= 0 ? SCALING_VALUE - nJoyX : SCALING_VALUE) } else { nMotPremixL = (nJoyX >= 0 ? SCALING_VALUE - nJoyX : SCALING_VALUE); nMotPremixR = (nJoyX >= 0 ? SCALING_VALUE : SCALING_VALUE + parseFloat(nJoyX)) } nMotPremixL = nMotPremixL * nJoyY / SCALING_VALUE; nMotPremixR = nMotPremixR * nJoyY / SCALING_VALUE; nPivSpeed = nJoyX; fPivScale = (Math.abs(nJoyY) > fPivYLimit) ? 0.0 : (1.0 - Math.abs(nJoyY) / fPivYLimit); nMotMixL = (1.0 - fPivScale) * nMotPremixL + fPivScale * (nPivSpeed); nMotMixR = (1.0 - fPivScale) * nMotPremixR + fPivScale * (-nPivSpeed); return (nMotMixL / SCALING_VALUE + "," + nMotMixR / SCALING_VALUE)} setInterval(function () { let data = getDrivePowerFrom(CustomJoystick.GetX(), CustomJoystick.GetY()); console.log(data); ws_send(data) }, 300);</script></body></html>